---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import FormattedDate from "../../components/FormattedDate.astro";
import { slugify } from "../../utils/slug";

const posts = (await getCollection("blog"))
	.sort((b, a) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf())
	.slice(0, 5);
---

<section class='my-16 w-full bg-cream'>
	<div class='max-w-[1240px] mx-auto px-4 py-16'>
		<div class='flex gap-6 justify-between items-end mb-10'>
			<h2 class='m-0 text-3xl font-bold text-black'>Últimos artículos</h2>
			<a href='/blog/' class='no-underline text-red hover:underline'>
				Ver todo
			</a>
		</div>

		<ul class='grid gap-4 md:grid-cols-2 lg:grid-cols-3'>
			{
				posts.map((post, index) => {
					const slug = slugify(post.data.slug || post.slug);
					const heroImage = post.data.heroImage;

					return (
						<li
							class={`list-none ${index === 0 ? "md:col-span-2" : ""}`}>
							<a
								href={`/blog/${slug}/`}
								class='block text-black no-underline'>
								<div class='w-full aspect-[2/1] overflow-hidden rounded-lg mb-4 relative'>
									{heroImage && (
										<Image
											src={heroImage}
											width={1200}
											height={600}
											alt={
												post.data.title ||
												"Blog post image"
											}
											class='object-cover w-full h-full'
											loading={
												index === 0 ? "eager" : "lazy"
											}
										/>
									)}
									<div class='absolute top-3 right-3 px-3 py-1 text-xs font-medium text-black rounded-full bg-cream'>
										<FormattedDate
											date={post.data.pubDate}
											class='text-black no-underline'
										/>
									</div>
								</div>

								<div class='flex flex-col'>
									<h3
										class={`font-semibold text-black no-underline m-0 ${index === 0 ? "text-2xl md:text-3xl" : "text-xl md:text-2xl"}`}>
										{post.data.title}
									</h3>
									<p class='mt-1 text-sm leading-relaxed text-black'>
										{post.data.summary ??
											post.data.description}
									</p>
								</div>
							</a>
						</li>
					);
				})
			}
		</ul>
	</div>
</section>
