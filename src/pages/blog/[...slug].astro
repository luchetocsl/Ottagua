---
import { type CollectionEntry, getCollection } from "astro:content";
import BlogPost from "../../layouts/BlogPost.astro";
import { slugify } from "../../utils/slug";

export async function getStaticPaths() {
	const posts = await getCollection("blog");
	return posts.map((post) => {
		const slug = slugify(post.data.slug || post.slug);
		return {
			params: { slug },
			props: {
				post,
				allPosts: posts,
			},
		};
	});
}

interface Props {
	post: CollectionEntry<"blog">;
	allPosts: CollectionEntry<"blog">[];
}

const { post, allPosts } = Astro.props;
const { Content } = await post.render();
const currentSlug = slugify(post.data.slug || post.slug);
---

<BlogPost {...post.data} currentSlug={currentSlug} allPosts={allPosts}>
	<Content />
</BlogPost>
