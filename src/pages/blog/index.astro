---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import FormattedDate from "../../components/FormattedDate.astro";
import { slugify } from "../../utils/slug";

import BaseLayout from "../../layouts/BaseLayout.astro";

// Get all blog posts and sort by date
const posts = (await getCollection("blog")).sort(
	(b, a) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf()
);
---

<BaseLayout>
	<div class='max-w-[1240px] mx-auto px-4 py-16'>
		<main>
			<ul class='grid gap-4 md:grid-cols-2 lg:grid-cols-3'>
				{
					posts.map((post, index) => {
						const slug = slugify(post.data.slug || post.slug);
						const heroImage = post.data.heroImage;
						return (
							<li
								class={`list-none ${index === 0 ? "md:col-span-2" : ""}`}>
								<a
									href={`/blog/${slug}/`}
									class='block text-black no-underline'>
									<div class='w-full aspect-[2/1] overflow-hidden rounded-lg mb-4 relative'>
										{heroImage && (
											<Image
												src={heroImage}
												width={1200}
												height={600}
												alt={
													post.data.title ||
													"Blog post image"
												}
												class='object-cover w-full h-full'
												loading={
													index === 0
														? "eager"
														: "lazy"
												}
											/>
										)}
										<div class='absolute top-3 right-3 px-3 py-1 text-xs font-medium text-black rounded-full bg-cream'>
											<FormattedDate
												date={post.data.pubDate}
												class='text-black no-underline'
											/>
										</div>
									</div>
									<div class='flex flex-col'>
										<h3
											class={`font-semibold text-black no-underline m-0 ${index === 0 ? "text-2xl md:text-3xl" : "text-xl md:text-2xl"}`}>
											{post.data.title}
										</h3>
										{post.data.tags?.length ? (
											<div class='mt-3 flex flex-wrap gap-2'>
												{post.data.tags.map((tag) => (
													<span class='px-3 py-1 text-xs font-medium text-black rounded-full border border-black/15 bg-cream/60'>
														{tag}
													</span>
												))}
											</div>
										) : null}
										<p class='mt-2 text-sm leading-relaxed text-black'>
											{post.data.summary ??
												post.data.description}
										</p>
									</div>
								</a>
							</li>
						);
					})
				}
			</ul>
		</main>
	</div>
</BaseLayout>

<!-- All styling now handled by Tailwind classes -->
