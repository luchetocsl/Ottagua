---
import type { CollectionEntry } from "astro:content";
import { slugify } from "../utils/slug";

interface Props {
	currentSlug: string;
	posts: CollectionEntry<"blog">[];
}

const { currentSlug, posts } = Astro.props;

// Sort posts by publication date (newest first)
const sortedPosts = [...posts].sort(
	(a, b) =>
		new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
);

// Find the index of the current post
const currentIndex = sortedPosts.findIndex(
	(post) => slugify(post.data.slug || post.slug) === currentSlug
);

// Get previous and next posts
const prevPost =
	currentIndex < sortedPosts.length - 1
		? sortedPosts[currentIndex + 1]
		: null;
const nextPost = currentIndex > 0 ? sortedPosts[currentIndex - 1] : null;
---

<div class='my-4 pt-2 mt-32 mx-auto max-w-[1240px]'>
	<div class='flex justify-between items-end'>
		{
			prevPost && (
				<a
					href={`/blog/${slugify(prevPost.data.slug || prevPost.slug)}/`}
					class='flex items-center no-underline py-0.5 max-w-[35%]
					w-[200px] text-black hover:text-red-accent'>
					<div class='mx-1 text-xs text-black'>←</div>
					<div class='flex-1 text-left'>
						<div class='text-black text-[10px] mb-0.5'>
							Artículo anterior
						</div>
						<div class='text-xs font-normal leading-tight text-black'>
							{prevPost.data.title}
						</div>
					</div>
				</a>
			)
		}

		{!prevPost && <div class='w-[35%] w-[200px]' />}

		<a
			href='/blog/'
			class='flex justify-center items-end pb-0.5 w-1/6 text-black no-underline hover:text-red-accent'>
			<div class='text-black font-normal text-[10px]'>Volver al blog</div>
		</a>

		{
			nextPost && (
				<a
					href={`/blog/${slugify(nextPost.data.slug || nextPost.slug)}/`}
					class='flex items-center no-underline py-0.5 max-w-[35%] w-[200px] text-black hover:text-red-accent'>
					<div class='flex-1 text-right'>
						<div class='text-black text-[10px] mb-0.5'>
							Artículo siguiente
						</div>
						<div class='text-xs font-normal leading-tight text-black'>
							{nextPost.data.title}
						</div>
					</div>
					<div class='mx-1 text-xs text-black'>→</div>
				</a>
			)
		}

		{!nextPost && <div class='w-[35%]' />}
	</div>
</div>

<style>
	/* All styling now handled by Tailwind classes */
	@media (max-width: 768px) {
		div[class*="flex justify-between"] {
			@apply flex-col gap-3;
		}

		a[class*="max-w-[35%]"],
		div[class*="w-[40%]"] {
			@apply max-w-full;
		}

		a[class*="w-1/5"] {
			@apply w-full my-3 justify-center;
		}

		div[class*="text-right"] {
			@apply text-left;
		}

		a[class*="flex items-center"]:last-child {
			@apply flex-row-reverse;
		}

		div[class*="text-sm font-normal"] {
			@apply text-xs;
		}
	}
</style>
